---
title: "Budget & Hochrechnung - Report"
format: html
execute:
  echo: false
  warning: false
---

```{r setup}
library(dplyr)
library(readr)
library(ggplot2)
library(targets)

# Lade Daten aus targets
results <- tar_read(calculation_result)
summary <- tar_read(summary_table)
```

## Zusammenfassung

```{r}
knitr::kable(summary, format = "html")
```

## CR-Analyse (Combined Ratio)

Zielbereich: 85% - 105%

```{r}
ggplot(results, aes(x = product_id, y = cr, fill = cr_status)) +
  geom_col() +
  geom_hline(yintercept = 0.85, linetype = "dashed", color = "green") +
  geom_hline(yintercept = 1.05, linetype = "dashed", color = "red") +
  labs(title = "Combined Ratio nach Produkt", x = "Produkt", y = "CR", fill = "Status") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

## SQ-Analyse (Schadenquote)

Zielbereich: 60% - 80%

```{r}
ggplot(results, aes(x = product_id, y = sq, fill = sq_status)) +
  geom_col() +
  geom_hline(yintercept = 0.60, linetype = "dashed", color = "green") +
  geom_hline(yintercept = 0.80, linetype = "dashed", color = "red") +
  labs(title = "Schadenquote nach Produkt", x = "Produkt", y = "SQ", fill = "Status") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

## Rohdaten

```{r}
DT::datatable(results, options = list(pageLength = 10))
```
